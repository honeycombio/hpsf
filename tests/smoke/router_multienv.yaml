components:
  # Receiver
  - name: Receive OTel
    kind: OTelReceiver

  # Router for dev, staging, and production environments
  - name: router
    kind: Router
    properties:
      - name: Environments
        value: [dev, staging, production]
      - name: RoutingAttribute
        value: deployment.environment
      - name: DefaultEnvironment
        value: dev

  # Sampling sequencers for each environment (traces and logs)
  - name: SamplingSequencer_dev
    kind: SamplingSequencer

  - name: SamplingSequencer_staging
    kind: SamplingSequencer

  - name: SamplingSequencer_production
    kind: SamplingSequencer

  # Samplers for each environment with different sample rates
  - name: DeterministicSampler_dev
    kind: DeterministicSampler
    properties:
      - name: SampleRate
        value: 1

  - name: DeterministicSampler_staging
    kind: DeterministicSampler
    properties:
      - name: SampleRate
        value: 10

  - name: DeterministicSampler_production
    kind: DeterministicSampler
    properties:
      - name: SampleRate
        value: 100

  # Exporters for each environment
  - name: HoneycombExporter_dev
    kind: HoneycombExporter

  - name: HoneycombExporter_staging
    kind: HoneycombExporter

  - name: HoneycombExporter_production
    kind: HoneycombExporter

connections:
  # Receiver to router for all signals
  # Traces
  - source:
      component: Receive OTel
      port: Traces
      type: OTelTraces
    destination:
      component: router
      port: Traces
      type: OTelTraces

  # Logs
  - source:
      component: Receive OTel
      port: Logs
      type: OTelLogs
    destination:
      component: router
      port: Logs
      type: OTelLogs

  # Metrics
  - source:
      component: Receive OTel
      port: Metrics
      type: OTelMetrics
    destination:
      component: router
      port: Metrics
      type: OTelMetrics

  # Dev environment: traces and logs go through sampling
  - source:
      component: router
      port: Traces
      type: OTelTraces
    destination:
      component: SamplingSequencer_dev
      port: Traces
      type: OTelTraces
  - source:
      component: router
      port: Logs
      type: OTelLogs
    destination:
      component: SamplingSequencer_dev
      port: Logs
      type: OTelLogs

  # Dev: sampling to sampler
  - source:
      component: SamplingSequencer_dev
      port: Rule 1
      type: SampleData
    destination:
      component: DeterministicSampler_dev
      port: Sample
      type: SampleData

  # Dev: sampler output to exporter
  - source:
      component: DeterministicSampler_dev
      port: Events
      type: HoneycombEvents
    destination:
      component: HoneycombExporter_dev
      port: Events
      type: HoneycombEvents

  # Dev: metrics bypass sampling and go directly to exporter
  - source:
      component: router
      port: Metrics
      type: OTelMetrics
    destination:
      component: HoneycombExporter_dev
      port: Metrics
      type: OTelMetrics

  # Staging environment: traces and logs go through sampling
  - source:
      component: router
      port: Traces
      type: OTelTraces
    destination:
      component: SamplingSequencer_staging
      port: Traces
      type: OTelTraces
  - source:
      component: router
      port: Logs
      type: OTelLogs
    destination:
      component: SamplingSequencer_staging
      port: Logs
      type: OTelLogs

  # Staging: sampling to sampler
  - source:
      component: SamplingSequencer_staging
      port: Rule 1
      type: SampleData
    destination:
      component: DeterministicSampler_staging
      port: Sample
      type: SampleData

  # Staging: sampler output to exporter
  - source:
      component: DeterministicSampler_staging
      port: Events
      type: HoneycombEvents
    destination:
      component: HoneycombExporter_staging
      port: Events
      type: HoneycombEvents

  # Staging: metrics bypass sampling and go directly to exporter
  - source:
      component: router
      port: Metrics
      type: OTelMetrics
    destination:
      component: HoneycombExporter_staging
      port: Metrics
      type: OTelMetrics

  # Production environment: traces and logs go through sampling
  - source:
      component: router
      port: Traces
      type: OTelTraces
    destination:
      component: SamplingSequencer_production
      port: Traces
      type: OTelTraces
  - source:
      component: router
      port: Logs
      type: OTelLogs
    destination:
      component: SamplingSequencer_production
      port: Logs
      type: OTelLogs

  # Production: sampling to sampler
  - source:
      component: SamplingSequencer_production
      port: Rule 1
      type: SampleData
    destination:
      component: DeterministicSampler_production
      port: Sample
      type: SampleData

  # Production: sampler output to exporter
  - source:
      component: DeterministicSampler_production
      port: Events
      type: HoneycombEvents
    destination:
      component: HoneycombExporter_production
      port: Events
      type: HoneycombEvents

  # Production: metrics bypass sampling and go directly to exporter
  - source:
      component: router
      port: Metrics
      type: OTelMetrics
    destination:
      component: HoneycombExporter_production
      port: Metrics
      type: OTelMetrics

layout:
  components:
    - name: Receive OTel
      position:
        x: -800
        y: 0
    - name: router
      position:
        x: -500
        y: 0
    - name: SamplingSequencer_dev
      position:
        x: -200
        y: -400
    - name: SamplingSequencer_staging
      position:
        x: -200
        y: 0
    - name: SamplingSequencer_production
      position:
        x: -200
        y: 400
    - name: DeterministicSampler_dev
      position:
        x: 100
        y: -400
    - name: DeterministicSampler_staging
      position:
        x: 100
        y: 0
    - name: DeterministicSampler_production
      position:
        x: 100
        y: 400
    - name: HoneycombExporter_dev
      position:
        x: 400
        y: -400
    - name: HoneycombExporter_staging
      position:
        x: 400
        y: 0
    - name: HoneycombExporter_production
      position:
        x: 400
        y: 400
