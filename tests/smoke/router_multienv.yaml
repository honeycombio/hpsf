components:
  # Receiver
  - name: Receive OTel
    kind: OTelReceiver

  # Router for dev, staging, and production environments
  - name: router
    kind: Router
    properties:
      - name: Environments
        value: [dev, staging, production]
      - name: RoutingAttribute
        value: deployment.environment
      - name: DefaultEnvironment
        value: dev

  # Sampling sequencers for each environment (traces and logs)
  - name: Start Sampling Dev
    kind: SamplingSequencer
    properties:
      - name: EnvironmentName
        value: dev

  - name: Start Sampling Staging
    kind: SamplingSequencer
    properties:
      - name: EnvironmentName
        value: staging

  - name: Start Sampling Production
    kind: SamplingSequencer
    properties:
      - name: EnvironmentName
        value: production

  # Samplers for each environment with different sample rates
  - name: Sampler Dev
    kind: DeterministicSampler
    properties:
      - name: SampleRate
        value: 1

  - name: Sampler Staging
    kind: DeterministicSampler
    properties:
      - name: SampleRate
        value: 10

  - name: Sampler Production
    kind: DeterministicSampler
    properties:
      - name: SampleRate
        value: 100

  # Exporters for each environment
  - name: exporter_dev
    kind: HoneycombExporter
    properties:
      - name: EnvironmentName
        value: dev

  - name: exporter_staging
    kind: HoneycombExporter
    properties:
      - name: EnvironmentName
        value: staging

  - name: exporter_production
    kind: HoneycombExporter
    properties:
      - name: EnvironmentName
        value: production

connections:
  # Receiver to router for all signals
  # Traces
  - source:
      component: Receive OTel
      port: Traces
      type: OTelTraces
    destination:
      component: router
      port: Traces
      type: OTelTraces

  # Logs
  - source:
      component: Receive OTel
      port: Logs
      type: OTelLogs
    destination:
      component: router
      port: Logs
      type: OTelLogs

  # Metrics
  - source:
      component: Receive OTel
      port: Metrics
      type: OTelMetrics
    destination:
      component: router
      port: Metrics
      type: OTelMetrics

  # Dev environment: traces and logs go through sampling
  - source:
      component: router
      port: Traces
      type: OTelTraces
    destination:
      component: Start Sampling Dev
      port: Traces
      type: OTelTraces
  - source:
      component: router
      port: Logs
      type: OTelLogs
    destination:
      component: Start Sampling Dev
      port: Logs
      type: OTelLogs

  # Dev: sampling to sampler
  - source:
      component: Start Sampling Dev
      port: Rule 1
      type: SampleData
    destination:
      component: Sampler Dev
      port: Sample
      type: SampleData

  # Dev: sampler output to exporter
  - source:
      component: Sampler Dev
      port: Events
      type: HoneycombEvents
    destination:
      component: exporter_dev
      port: Events
      type: HoneycombEvents

  # Dev: metrics bypass sampling and go directly to exporter
  - source:
      component: router
      port: Metrics
      type: OTelMetrics
    destination:
      component: exporter_dev
      port: Metrics
      type: OTelMetrics

  # Staging environment: traces and logs go through sampling
  - source:
      component: router
      port: Traces
      type: OTelTraces
    destination:
      component: Start Sampling Staging
      port: Traces
      type: OTelTraces
  - source:
      component: router
      port: Logs
      type: OTelLogs
    destination:
      component: Start Sampling Staging
      port: Logs
      type: OTelLogs

  # Staging: sampling to sampler
  - source:
      component: Start Sampling Staging
      port: Rule 1
      type: SampleData
    destination:
      component: Sampler Staging
      port: Sample
      type: SampleData

  # Staging: sampler output to exporter
  - source:
      component: Sampler Staging
      port: Events
      type: HoneycombEvents
    destination:
      component: exporter_staging
      port: Events
      type: HoneycombEvents

  # Staging: metrics bypass sampling and go directly to exporter
  - source:
      component: router
      port: Metrics
      type: OTelMetrics
    destination:
      component: exporter_staging
      port: Metrics
      type: OTelMetrics

  # Production environment: traces and logs go through sampling
  - source:
      component: router
      port: Traces
      type: OTelTraces
    destination:
      component: Start Sampling Production
      port: Traces
      type: OTelTraces
  - source:
      component: router
      port: Logs
      type: OTelLogs
    destination:
      component: Start Sampling Production
      port: Logs
      type: OTelLogs

  # Production: sampling to sampler
  - source:
      component: Start Sampling Production
      port: Rule 1
      type: SampleData
    destination:
      component: Sampler Production
      port: Sample
      type: SampleData

  # Production: sampler output to exporter
  - source:
      component: Sampler Production
      port: Events
      type: HoneycombEvents
    destination:
      component: exporter_production
      port: Events
      type: HoneycombEvents

  # Production: metrics bypass sampling and go directly to exporter
  - source:
      component: router
      port: Metrics
      type: OTelMetrics
    destination:
      component: exporter_production
      port: Metrics
      type: OTelMetrics

layout:
  components:
    - name: Receive OTel
      position:
        x: -800
        y: 0
    - name: router
      position:
        x: -500
        y: 0
    - name: Start Sampling Dev
      position:
        x: -200
        y: -400
    - name: Start Sampling Staging
      position:
        x: -200
        y: 0
    - name: Start Sampling Production
      position:
        x: -200
        y: 400
    - name: Sampler Dev
      position:
        x: 100
        y: -400
    - name: Sampler Staging
      position:
        x: 100
        y: 0
    - name: Sampler Production
      position:
        x: 100
        y: 400
    - name: exporter_dev
      position:
        x: 400
        y: -400
    - name: exporter_staging
      position:
        x: 400
        y: 0
    - name: exporter_production
      position:
        x: 400
        y: 400
