kind: RemoveAttributeProcessor
name: Remove Attribute Processor
style: processor
type: base
status: development
version: v0.0.1
summary: A processor that can be used to remove attributes in telemetry.
description: |
  This processor allows you to remove attributes from traces, metrics, and logs by
  specifying a list of attribute names. It can be used to filter out sensitive or
  unnecessary information from your telemetry data.
  The processor supports the removal of attributes in resources, spans, metrics, and logs.
tags:
  - category:processor
  - service:collector
  - category:filter
  - signal:OTelTraces
  - signal:OTelMetrics
  - signal:OTelLogs
ports:
  # inputs
  - name: Traces
    direction: input
    type: OTelTraces
  - name: Logs
    direction: input
    type: OTelLogs
  - name: Metrics
    direction: input
    type: OTelMetrics
  # outputs
  - name: Traces
    direction: output
    type: OTelTraces
  - name: Logs
    direction: output
    type: OTelLogs
  - name: Metrics
    direction: output
    type: OTelMetrics
properties:
  - name: Attributes
    summary: A list of attribute names to remove.
    description: |
      A list of attribute names that will be removed from the telemetry data.
    type: stringarray
    validations:
      - noblanks
      - noempty
templates:
  - kind: collector_config
    name: otel_remove_attributes_processor
    format: collector
    meta:
      componentSection: processors
      signalTypes: [traces, metrics, logs]
      collectorComponentName: transform
    data:
      - key: "{{ .ComponentName }}.error_mode"
        value: "ignore"
      # Trace statements
      - key: "{{ .ComponentName }}.trace_statements"
        value: "{{ .Values.Attributes | encodeAsArrayWithFormat \"delete_key(resource.attributes, \\\"%s\\\")\" }}"
      - key: "{{ .ComponentName }}.trace_statements"
        value: "{{ .Values.Attributes | encodeAsArrayWithFormat \"delete_key(span.attributes, \\\"%s\\\")\" }}"
      # Metric statements
      - key: "{{ .ComponentName }}.metric_statements"
        value: "{{ .Values.Attributes | encodeAsArrayWithFormat \"delete_key(resource.attributes, \\\"%s\\\")\" }}"
      - key: "{{ .ComponentName }}.metric_statements"
        value: "{{ .Values.Attributes | encodeAsArrayWithFormat \"delete_key(metric.attributes, \\\"%s\\\")\" }}"
      # Log statements
      - key: "{{ .ComponentName }}.log_statements"
        value: "{{ .Values.Attributes | encodeAsArrayWithFormat \"delete_key(resource.attributes, \\\"%s\\\")\" }}"
      - key: "{{ .ComponentName }}.log_statements"
        value: "{{ .Values.Attributes | encodeAsArrayWithFormat \"delete_key(log.attributes, \\\"%s\\\")\" }}"
