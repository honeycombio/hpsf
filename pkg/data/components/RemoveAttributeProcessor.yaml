kind: RemoveAttributeProcessor
name: Remove Attribute Processor
style: processor
type: base
status: development
version: v0.0.1
summary: A processor that can be used to remove attributes in telemetry.
description: |
  This processor allows you to remove attributes from traces, metrics, and logs by
  specifying a list of attribute names. It can be used to filter out sensitive or
  unnecessary information from your telemetry data.
  The processor supports the removal of attributes from both resource and span levels
  for traces, and from metrics and logs as well.
tags:
  - category:processor
  - service:collector
  - category:filter
  - signal:OTelTraces
  - signal:OTelMetrics
  - signal:OTelLogs
ports:
  # inputs
  - name: Traces
    direction: input
    type: OTelTraces
  - name: Logs
    direction: input
    type: OTelLogs
  - name: Metrics
    direction: input
    type: OTelMetrics
  # outputs
  - name: Traces
    direction: output
    type: OTelTraces
  - name: Logs
    direction: output
    type: OTelLogs
  - name: Metrics
    direction: output
    type: OTelMetrics
properties:
  - name: ResourceAttributeNames
    summary: A list of resource attribute names to be removed from the telemetry data.
    description: |
      A list of resource attribute names to be removed.
    type: stringarray
    validations:
      - noblanks
    default: []
  - name: SpanAttributeNames
    summary: A list of span attribute names to be removed from the telemetry data.
    description: |
      A list of span attribute names to be removed.
    type: stringarray
    validations:
      - noblanks
    default: []
  - name: MetricAttributeNames
    summary: A list of metric attribute names to be removed from the telemetry data.
    description: |
      A list of metric attribute names to be removed.
    type: stringarray
    validations:
      - noblanks
    default: []
  - name: LogAttributeNames
    summary: A list of log attribute names to be removed from the telemetry data.
    description: |
      A list of log attribute names to be removed.
    type: stringarray
    validations:
      - noblanks
    default: []
templates:
  - kind: collector_config
    name: otel_remove_attributes_processor
    format: collector
    meta:
      componentSection: processors
      signalTypes: [traces, metrics, logs]
      collectorComponentName: transform
    data:
      - key: "{{ .ComponentName }}.error_mode"
        value: "ignore"
      # Trace statements
      - key: "{{ .ComponentName }}.trace_statements"
        value: "{{ .Values.ResourceAttributeNames | encodeAsArrayWithFormat \"delete_key(resource.attributes, \\\"%s\\\")\" }}"
        suppress_if: "{{ not .Values.ResourceAttributeNames }}"
      - key: "{{ .ComponentName }}.trace_statements"
        value: "{{ .Values.SpanAttributeNames | encodeAsArrayWithFormat \"delete_key(span.attributes, \\\"%s\\\")\" }}"
        suppress_if: "{{ not .Values.SpanAttributeNames }}"
      # Metric statements
      - key: "{{ .ComponentName }}.metric_statements"
        value: "{{ .Values.ResourceAttributeNames | encodeAsArrayWithFormat \"delete_key(resource.attributes, \\\"%s\\\")\" }}"
        suppress_if: "{{ not .Values.ResourceAttributeNames }}"
      - key: "{{ .ComponentName }}.metric_statements"
        value: "{{ .Values.MetricAttributeNames | encodeAsArrayWithFormat \"delete_key(metric.attributes, \\\"%s\\\")\" }}"
        suppress_if: "{{ not .Values.MetricAttributeNames }}"
      # Log statements
      - key: "{{ .ComponentName }}.log_statements"
        value: "{{ .Values.ResourceAttributeNames | encodeAsArrayWithFormat \"delete_key(resource.attributes, \\\"%s\\\")\" }}"
        suppress_if: "{{ not .Values.ResourceAttributeNames }}"
      - key: "{{ .ComponentName }}.log_statements"
        value: "{{ .Values.LogAttributeNames | encodeAsArrayWithFormat \"delete_key(log.attributes, \\\"%s\\\")\" }}"
        suppress_if: "{{ not .Values.LogAttributeNames }}"
