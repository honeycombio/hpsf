kind: RemoveAttributesProcessor
name: Remove Attributes
style: processor
type: base
status: development
version: v0.0.1
summary: A processor that can be used to remove attributes in telemetry.
description: |
  This processor allows you to remove attributes from traces, metrics, and logs by
  specifying a list of attribute names. It can be used to filter out sensitive or
  unnecessary information from your telemetry data.
  It can optionally remove resource attributes by setting the `RemoveResourceAttributes`
  property to `true` (default is `false`).
tags:
  - category:processor
  - service:collector
  - category:filter
  - signal:OTelTraces
  - signal:OTelMetrics
  - signal:OTelLogs
ports:
  # inputs
  - name: Traces
    direction: input
    type: OTelTraces
  - name: Logs
    direction: input
    type: OTelLogs
  - name: Metrics
    direction: input
    type: OTelMetrics
  # outputs
  - name: Traces
    direction: output
    type: OTelTraces
  - name: Logs
    direction: output
    type: OTelLogs
  - name: Metrics
    direction: output
    type: OTelMetrics
properties:
  - name: Attributes
    summary: A list of attribute names to remove.
    description: |
      A list of attribute names that will be removed from the telemetry data.
    type: stringarray
    validations:
      - noblanks
      - nonempty
  - name: AttributeLocation
    summary: A flag that indicates whether to remove resource or record attributes.
    description: |
      A flag that indicates whether to remove resource or record attributes from the telemetry data.
    type: string
    sub_type: oneof(record, resource)
    validations:
      - oneof(record, resource)
    default: record
templates:
  - kind: collector_config
    name: otel_remove_attributes_processor
    format: collector
    meta:
      componentSection: processors
      signalTypes: [traces, metrics, logs]
      collectorComponentName: transform
    data:
      - key: "{{ .ComponentName }}.error_mode"
        value: "ignore"
      # Trace statements
      - key: "{{ .ComponentName }}.trace_statements"
        value: '{{ .Values.Attributes | encodeAsStringArray "delete_key(resource.attributes, \"%s\")" }}'
        suppress_if: '{{ eq .Values.AttributeLocation "record" }}'
      - key: "{{ .ComponentName }}.trace_statements"
        value: '{{ .Values.Attributes | encodeAsStringArray "delete_key(span.attributes, \"%s\")" }}'
        suppress_if: '{{ eq .Values.AttributeLocation "resource" }}'
      # Metric statements
      - key: "{{ .ComponentName }}.metric_statements"
        value: '{{ .Values.Attributes | encodeAsStringArray "delete_key(resource.attributes, \"%s\")" }}'
        suppress_if: '{{ eq .Values.AttributeLocation "record" }}'
      - key: "{{ .ComponentName }}.metric_statements"
        value: '{{ .Values.Attributes | encodeAsStringArray "delete_key(metric.attributes, \"%s\")" }}'
        suppress_if: '{{ eq .Values.AttributeLocation "resource" }}'
      # Log statements
      - key: "{{ .ComponentName }}.log_statements"
        value: '{{ .Values.Attributes | encodeAsStringArray "delete_key(resource.attributes, \"%s\")" }}'
        suppress_if: '{{ eq .Values.AttributeLocation "record" }}'
      - key: "{{ .ComponentName }}.log_statements"
        value: '{{ .Values.Attributes | encodeAsStringArray "delete_key(log.attributes, \"%s\")" }}'
        suppress_if: '{{ eq .Values.AttributeLocation "resource" }}'
