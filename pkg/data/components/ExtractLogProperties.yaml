kind: ExtractLogSeverityProcessor
name: Extract Log Severity
style: processor
type: base
status: development
version: v0.0.1
summary: Extracts the OpenTelemetry log severity from the log's body field
description: |-
  This processor extracts the log severity from the log's body field, which is expected to be in JSON format.
  It sets the severity_text, severity_number and severity_text attributes according to the detected severity type.
tags:
  - category:processor
  - service:collector
  - signal:OTelLogs
ports:
  # inputs
  - name: Logs
    direction: input
    type: OTelLogs
  # outputs
  - name: Logs
    direction: output
    type: OTelLogs
properties:
  - name: Field
    type: string
    validations:
      - noblanks
    default: type
  - name: InfoText
    type: string
    validations:
      - noblanks
    default: Info
  - name: WarningText
    type: string
    validations:
      - noblanks
    default: Warn
  - name: ErrorText
    type: string
    validations:
      - noblanks
    default: Error
templates:
  - kind: collector_config
    name: otel_extract_log_severity
    format: collector
    meta:
      componentSection: processors
      signalTypes: [logs]
      collectorComponentName: transform
    data:
      - key: "{{ .ComponentName }}.error_mode"
        value: "ignore"
      - key: "{{ .ComponentName }}.log_statements[0]"
        value: "set(severity_text, attributes[\"{{ .Values.Field }}\"]) where attributes[\"{{ .Values.Field }}\"] == \"{{ .Values.InfoText }}\" or attributes[\"{{ .Values.Field }}\"] == \"{{ .Values.WarningText }}\" or attributes[\"{{ .Values.Field }}\"] == \"{{ .Values.ErrorText }}\""
      - key: "{{ .ComponentName }}.log_statements[1]"
        value: "set(severity_number, SEVERITY_NUMBER_INFO) where attributes[\"{{ .Values.Field }}\"] == \"{{ .Values.InfoText }}\""
      - key: "{{ .ComponentName }}.log_statements[2]"
        value: "set(severity_number, SEVERITY_NUMBER_WARN) where attributes[\"{{ .Values.Field }}\"] == \"{{ .Values.WarningText }}\""
      - key: "{{ .ComponentName }}.log_statements[3]"
        value: "set(severity_number, SEVERITY_NUMBER_ERROR) where attributes[\"{{ .Values.Field }}\"] == \"{{ .Values.ErrorText }}\""
