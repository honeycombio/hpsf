kind: ExtractLogSeverityProcessor
name: Extract Log Severity
style: processor
type: base
status: development
version: v0.0.1
summary: Extracts the OpenTelemetry log severity from the log.body field
description: |-
  This processor extracts the log severity from the log.body field, which is expected to be in JSON format.
  It sets the severity_text, severity_number and severity_text attributes according to the detected severity type.
tags:
  - category:processor
  - service:collector
  - signal:OTelLogs
ports:
  # inputs
  - name: Logs
    direction: input
    type: OTelLogs
  # outputs
  - name: Logs
    direction: output
    type: OTelLogs
templates:
  - kind: collector_config
    name: otel_filter
    format: collector
    meta:
      componentSection: processors
      signalTypes: [logs]
      collectorComponentName: transform
    data:
      - key: "{{ .ComponentName }}.error_mode"
        value: "ignore"
      - key: "{{ .ComponentName }}.log_statements[0].context"
        value: "log"
      - key: "{{ .ComponentName }}.log_statements[0].statements[0]"
        value: "set(severity_text, attributes[\"type\"]) where attributes[\"type\"] == \"Normal\" or attributes[\"type\"] == \"Warning\""
      - key: "{{ .ComponentName }}.log_statements[0].statements[1]"
        value: "set(severity_number, SEVERITY_NUMBER_INFO) where attributes[\"type\"] == \"Normal\""
      - key: "{{ .ComponentName }}.log_statements[0].statements[2]"
        value: "set(severity_number, SEVERITY_NUMBER_WARN) where attributes[\"type\"] == \"Warning\""
