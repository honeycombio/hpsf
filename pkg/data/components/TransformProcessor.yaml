kind: TransformProcessor
name: Transform Processor
style: processor
type: base
status: development
version: v0.1.0
summary: A processor that can be used to transform telemetry.
description: |
  Transforms traces, metrics and logs based on rules defined
  in the configuration.
tags:
  - category:processor
  - service:collector
  - category:transform
  - signal:OTelTraces
  - signal:OTelMetrics
  - signal:OTelLogs
ports:
  - name: TracesIn
    direction: input
    type: OTelTraces
  - name: TracesOut
    direction: output
    type: OTelTraces
  - name: MetricsIn
    direction: input
    type: OTelMetrics
  - name: MetricsOut
    direction: output
    type: OTelMetrics
  - name: LogsIn
    direction: input
    type: OTelLogs
  - name: LogsOut
    direction: output
    type: OTelLogs
properties:
  - name: ErrorMode
    type: string
    default: ignore
  - name: TracesStatements
    type: stringarray
    validations:
      - nonblank
      - nonempty
    default: []
  - name: MetricsStatements
    type: stringarray
    validations:
      - nonblank
      - nonempty
    default: []
  - name: LogsStatements
    type: stringarray
    validations:
      - nonblank
      - nonempty
    default: []
templates:
  - kind: collector_config
    name: otel_filter
    format: collector
    meta:
      componentSection: processors
      signalTypes: [traces, metrics, logs]
      collectorComponentName: transform
    data:
      - key: "{{ .ComponentName }}.error_mode"
        value: "{{ firstNonZero .HProps.ErrorMode .User.ErrorMode .Props.ErrorMode.Default }}"
      - key: "{{ .ComponentName }}.traces_statements"
        value: "{{ firstNonZero .HProps.TracesStatements .User.TracesStatements .Props.TracesStatements.Default | encodeAsArray }}"
        suppress_if: "{{ not .HProps.TracesStatements }}"
      - key: "{{ .ComponentName }}.metrics_statements"
        value: "{{ firstNonZero .HProps.MetricsStatements .User.MetricsStatements .Props.MetricsStatements.Default | encodeAsArray }}"
        suppress_if: "{{ not .HProps.MetricsStatements }}"
      - key: "{{ .ComponentName }}.logs_statements"
        value: "{{ firstNonZero .HProps.LogsStatements .User.LogsStatements .Props.LogsStatements.Default | encodeAsArray }}"
        suppress_if: "{{ not .HProps.LogsStatements }}"