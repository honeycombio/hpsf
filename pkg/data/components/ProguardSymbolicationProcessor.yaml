kind: ProguardSymbolicationProcessor
name: Symbolicate Java/Android Errors
style: processor
type: base
status: development
version: v0.1.0
summary: Symbolicate stack traces from Android applications using ProGuard mapping files
description: |
  Symbolicate Java/Kotlin stack traces from Android applications using ProGuard mapping files.
  Supports ProGuard mapping files stored in AWS S3 or Google Cloud Storage.
tags:
  - category:processor
  - service:collector
  - signal:OTelTraces
  - input:Traces
  - output:Traces
ports:
  # inputs
  - name: Traces
    direction: input
    type: OTelTraces
  # outputs
  - name: Traces
    direction: output
    type: OTelTraces
properties:
  - name: SymbolStore
    display: Symbol Store
    summary: Select the service where symbol files are stored
    description: |
      Select the service where symbol files are stored.
      Options are `AWSS3` and `GoogleCloudStorage`.
      The default is `AWSS3`.
    type: string
    subtype: oneof(AWSS3, GoogleCloudStorage)
    default: AWSS3
    validations:
      - oneof(AWSS3, GoogleCloudStorage)
  - name: BucketName
    display: Bucket Name
    summary: The bucket where symbol files are stored
    description: |
      The bucket where symbol files are stored. This is required.
      For `AWS S3`, this is the name of the AWS S3 bucket.
      For `Google Cloud Store`, this is the name of the Google Cloud Storage bucket.
      Examples: `my-proguard-maps`, `my-gcs-bucket`.
    type: string
    validations:
      - noblanks
  - name: Prefix
    display: Prefix
    summary: Prefix to use when searching for ProGuard files
    description: |
      Prefix to use when searching for ProGuard files. This is optional and can be used to specify a subdirectory within the bucket.
      If not specified, the root of the bucket will be used.
      Examples: `proguard-maps/`, `my-project/proguard-maps/`.
    type: string
    default: ""
    advanced: true
  - name: Region
    display: Region (AWS)
    summary: AWS S3 bucket region (optional)
    description: |
      AWS S3 bucket region. This is optional.
      Examples: `us-east-1`, `us-west-2`, `eu-central-1`.
    type: string
    default: ""
    advanced: true
templates:
  - kind: collector_config
    name: proguard_symbolicator_processor
    format: collector
    meta:
      componentSection: processors
      signalTypes: [traces]
      collectorComponentName: symbolicator
    data:
      # AWSS3
      - key: "{{ .ComponentName }}.proguard_store"
        value: "s3_store"
        suppress_if: '{{ not (eq "AWSS3" .Values.SymbolStore) }}'
      - key: "{{ .ComponentName }}.s3_proguard_maps.region"
        value: "{{ .Values.Region }}"
        suppress_if: '{{ or (not (eq "AWSS3" .Values.SymbolStore)) (eq .Values.Region "") }}'
      - key: "{{ .ComponentName }}.s3_proguard_maps.bucket"
        value: "{{ .Values.BucketName }}"
        suppress_if: '{{ not (eq "AWSS3" .Values.SymbolStore) }}'
      - key: "{{ .ComponentName }}.s3_proguard_maps.prefix"
        value: "{{ .Values.Prefix }}"
        suppress_if: '{{ or (not (eq "AWSS3" .Values.SymbolStore)) (eq .Values.Prefix "") }}'
      # GoogleCloudStorage
      - key: "{{ .ComponentName }}.proguard_store"
        value: "gcs_store"
        suppress_if: '{{ not (eq "GoogleCloudStorage" .Values.SymbolStore) }}'
      - key: "{{ .ComponentName }}.gcs_proguard_maps.bucket"
        value: "{{ .Values.BucketName }}"
        suppress_if: '{{ not (eq "GoogleCloudStorage" .Values.SymbolStore) }}'
      - key: "{{ .ComponentName }}.gcs_proguard_maps.prefix"
        value: "{{ .Values.Prefix }}"
        suppress_if: '{{ or (not (eq "GoogleCloudStorage" .Values.SymbolStore)) (eq .Values.Prefix "") }}'
