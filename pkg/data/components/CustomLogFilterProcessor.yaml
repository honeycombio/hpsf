kind: CustomLogFilterProcessor
name: Filter Logs by Custom OTTL
style: processor
type: base
status: development
version: v0.1.0
summary: Filters logs using custom OTTL statements (advanced)
description: |
  Apply custom filters to log records using configuration statements written in OpenTelemetry
  Transformation Language (OTTL). This is an advanced component. No OTTL validation is provided.
tags:
  - category:processor
  - service:collector
  - signal:OTelLogs
  - input:Logs
  - output:Logs
ports:
  # inputs
  - name: Logs
    direction: input
    type: OTelLogs
  # outputs
  - name: Logs
    direction: output
    type: OTelLogs
properties:
  - name: ErrorMode
    display: Error Mode
    type: string
    subtype: oneof(ignore, propagate)
    default: ignore
    summary: How to handle errors during filtering
    description: |
      Controls how the processor handles errors during filtering:
      - ignore: Log errors but continue processing
      - propagate: Stop processing and return the error
    validations:
      - oneof(ignore, propagate)
  - name: LogStatements
    display: Log Filter Statements
    type: stringarray
    summary: OTTL log filter statements
    description: |
      OpenTelemetry Transformation Language (OTTL) statements that define conditions for filtering log records.
      Each statement evaluates to true or false for each log record. Only records where all statements evaluate to true will be kept.
      Statements operate on the log_record context and can access log attributes, body, severity, and other log record fields.
      Examples:
      - 'severity_number < SEVERITY_NUMBER_INFO' - Keep logs with severity below INFO
      - 'attributes["log.level"] == "debug"' - Keep only debug level logs
      - 'IsMatch(body, ".*error.*")' - Keep logs containing "error" in the body
    validations:
      - noblanks
      - nonempty
templates:
  - kind: collector_config
    name: filter_processor
    format: collector
    meta:
      componentSection: processors
      signalTypes: [logs]
      collectorComponentName: filter
    data:
      - key: "{{ .ComponentName }}.error_mode"
        value: "{{ .Values.ErrorMode }}"
      - key: "{{ .ComponentName }}.logs.log_record"
        value: "{{ .Values.LogStatements | encodeAsArray }}"
