kind: FilterLogsByLibrary
name: Filter Logs By Library
style: processor
type: base
status: development
version: v0.1.0
summary: A processor that filters logs based on the library name.
description: |
  This component uses the OpenTelemetry filter processor to filter logs based
  on the library.name attribute. It allows you to include or exclude logs from
  specific libraries, which is useful for reducing noise from verbose libraries
  or focusing on specific components.
tags:
  - category:processor
  - service:collector
  - category:filter
  - signal:OTelLogs
ports:
  - name: Logs
    direction: input
    type: OTelLogs
properties:
  - name: LibraryNames
    type: string_array
    summary: List of library names to filter
    description: |
      A list of library names to filter. The behavior depends on the FilterMode
      setting - these libraries will either be included or excluded from the logs.
    validations:
      - nonempty
  - name: FilterMode
    type: string
    summary: Whether to include or exclude the specified libraries
    description: |
      Determines whether logs from the specified libraries should be included or excluded.
      'exclude' will filter out logs from these libraries, 'include' will only keep
      logs from these libraries.
    default: "exclude"
    subtype: oneof(include, exclude)
    validations:
      - oneof(include, exclude)
  - name: CaseSensitive
    type: boolean
    summary: Whether library name matching should be case sensitive
    description: |
      If true, library name matching will be case sensitive. If false, it will be
      case insensitive.
    default: true
    advanced: true
  - name: UseWildcards
    type: boolean
    summary: Whether to support wildcard patterns in library names
    description: |
      If true, library names can include wildcard patterns (* and ?). If false,
      only exact matches are supported.
    default: false
    advanced: true
templates:
  - kind: collector_config
    name: otel_filter
    format: collector
    meta:
      componentSection: processors
      signalTypes: [logs]
      collectorComponentName: filter
    data:
      - key: "{{ .ComponentName }}.logs.log_record"
        value: "{{ .Values.LibraryNames | encodeAsArrayWithFormat \"instrumentation_scope.name == \\\"%s\\\"\" }}"
        suppress_if: "{{ not .Values.LibraryNames }}"
