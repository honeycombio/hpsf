kind: SymbolicatorProcessor
name: Symbolicator Processor
style: processor
type: base
status: development
version: v0.1.0
summary: A processor that will symbolicate JavaScript stack traces using source maps.
description: |
  This processor is used to symbolicate JavaScript stack traces using source maps.
tags:
  - category:processor
  - service:collector
  - signal:OtelTraces
ports:
  - name: TracesIn
    direction: input
    type: OTelTraces
  - name: TracesOut
    direction: output
    type: OTelTraces
properties:
  - name: SourceMapStore
    type: string
    subtype: oneof(file_store, s3_store, gcs_store)
    validations:
      - oneof(file_store, s3_store, gcs_store)
  - name: Path
    type: string
  - name: Bucket
    type: string
  - name: Region
    type: string
  - name: Prefix
    type: string
templates:
  - kind: collector_config
    name: otel_logdedup
    format: collector
    meta:
      componentSection: processors
      signalTypes: [traces]
      collectorComponentName: symbolicator
    data:
      - key: "{{ .ComponentName }}.source_map_store"
        value: "{{ .HProps.SourceMapStore }}"
      # file_store
      - key: "{{ .ComponentName }}.local_source_maps.path"
        value: "{{ .HProps.Path }}"
        suppress_if: '{{ not (eq "file_store" .HProps.SourceMapStore) }}'
      # s3_store
      - key: "{{ .ComponentName }}.s3_source_maps.region"
        value: "{{ .HProps.Region }}"
        suppress_if: '{{ not (eq "s3_store" .HProps.SourceMapStore) }}'
      - key: "{{ .ComponentName }}.s3_source_maps.bucket"
        value: "{{ .HProps.Bucket }}"
        suppress_if: '{{ not (eq "s3_store" .HProps.SourceMapStore) }}'
      - key: "{{ .ComponentName }}.s3_source_maps.prefix"
        value: "{{ .HProps.Prefix }}"
        suppress_if: '{{ not (eq "s3_store" .HProps.SourceMapStore) }}'
      # gcs_store
      - key: "{{ .ComponentName }}.gcs_source_maps.bucket"
        value: "{{ .HProps.Bucket }}"
        suppress_if: '{{ not (eq "gcs_store" .HProps.SourceMapStore) }}'
      - key: "{{ .ComponentName }}.gcs_source_maps.prefix"
        value: "{{ .HProps.Prefix }}"
        suppress_if: '{{ not (eq "gcs_store" .HProps.SourceMapStore) }}'
