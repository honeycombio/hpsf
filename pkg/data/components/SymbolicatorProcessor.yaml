kind: SymbolicatorProcessor
name: Symbolicator Processor
style: processor
type: base
status: development
version: v0.1.0
summary: A processor that will symbolicate JavaScript stack traces using source maps.
description: |
  This processor is used to symbolicate JavaScript stack traces using source maps.
tags:
  - category:processor
  - service:collector
  - signal:OtelTraces
ports:
  - name: TracesIn
    direction: input
    type: OTelTraces
  - name: TracesOut
    direction: output
    type: OTelTraces
properties:
  - name: SourceMapStore
    type: string
    subtype: oneof(file_store, s3_store, gcs_store)
    validations:
      - oneof(file_store, s3_store, gcs_store)
  - name: Path
    type: string
  - name: Bucket
    type: string
  - name: Region
    type: string
  - name: Prefix
    type: string
templates:
  - kind: collector_config
    name: otel_logdedup
    format: collector
    meta:
      componentSection: processors
      signalTypes: [traces]
      collectorComponentName: symbolicator
    data:
      - key: "{{ .ComponentName }}.source_map_store"
        value: "{{ .HProps.SourceMapStore }}"
      # path is only required for file_store
      - key: "{{ .ComponentName }}.path"
        value: "{{ .HProps.Path }}"
        suppress_if: '{{ eq (or "s3_store" "gcs_store") .HProps.SourceMapStore }}'
      # region is only required for s3_store
      - key: "{{ .ComponentName }}.region"
        value: "{{ .HProps.Region }}"
        suppress_if: '{{ eq (or "file_store" "gcs_store") .HProps.SourceMapStore }}'
      # bucket and prefix are required for s3_store and gcs_store
      - key: "{{ .ComponentName }}.bucket"
        value: "{{ .HProps.Bucket }}"
        suppress_if: '{{ eq  "file_store" .HProps.SourceMapStore }}'
      - key: "{{ .ComponentName }}.prefix"
        value: "{{ .HProps.Prefix }}"
        suppress_if: '{{ eq  "file_store" .HProps.SourceMapStore }}'
