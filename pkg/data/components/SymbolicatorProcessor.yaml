kind: SymbolicatorProcessor
name: Symbolicator Processor
style: processor
type: base
status: development
version: v0.1.0
summary: A processor that will symbolicate JavaScript stack traces using source maps.
description: |
  This processor is used to symbolicate JavaScript stack traces using source maps.
tags:
  - category:processor
  - service:collector
  - signal:OtelTraces
ports:
  - name: TracesIn
    direction: input
    type: OTelTraces
  - name: TracesOut
    direction: output
    type: OTelTraces
properties:
  - name: SourceMapStore
    type: string
    subtype: oneof(s3_store, gcs_store)
    default: s3_store
    validations:
      - oneof(s3_store, gcs_store)
  - name: Path
    type: string
  - name: Bucket
    type: string
  - name: Region
    type: string
  - name: Prefix
    type: string
templates:
  - kind: collector_config
    name: otel_logdedup
    format: collector
    meta:
      componentSection: processors
      signalTypes: [traces]
      collectorComponentName: symbolicator
    data:
      - key: "{{ .ComponentName }}.source_map_store"
        value: "{{ .Values.SourceMapStore }}"
      # s3_store
      - key: "{{ .ComponentName }}.s3_source_maps.region"
        value: "{{ .Values.Region }}"
        suppress_if: '{{ not (eq "s3_store" .Values.SourceMapStore) }}'
      - key: "{{ .ComponentName }}.s3_source_maps.bucket"
        value: "{{ .Values.Bucket }}"
        suppress_if: '{{ not (eq "s3_store" .Values.SourceMapStore) }}'
      - key: "{{ .ComponentName }}.s3_source_maps.prefix"
        value: "{{ .Values.Prefix }}"
        suppress_if: '{{ not (eq "s3_store" .Values.SourceMapStore) }}'
      # gcs_store
      - key: "{{ .ComponentName }}.gcs_source_maps.bucket"
        value: "{{ .Values.Bucket }}"
        suppress_if: '{{ not (eq "gcs_store" .Values.SourceMapStore) }}'
      - key: "{{ .ComponentName }}.gcs_source_maps.prefix"
        value: "{{ .Values.Prefix }}"
        suppress_if: '{{ not (eq "gcs_store" .Values.SourceMapStore) }}'
