kind: NumericValueCondition
name: Check a Numeric Field
style: condition
type: base
status: alpha
version: v0.1.0
summary: Compare an int or num type field to a specified value
description: |-
  Check if any span of a trace has a specific int or num field that compares appropriately to the specified value.
tags:
  - category:condition
  - service:refinery
  - vendor:Honeycomb
  - type:error
  - input:SampleData
  - output:SampleData
ports:
  # inputs
  - name: Match
    direction: input
    type: SampleData
  # outputs
  - name: And
    direction: output
    type: SampleData
properties:
  - name: Fields
    summary: The field(s) to check. If any of the specified fields exist in any span of a trace, and its value matches the specified value, the condition will evaluate to true.
    type: stringarray
    validations:
      - nonempty
      - noblanks
  - name: Operator
    summary: The comparison operator to use when comparing the field value to the specified integer.
    type: string
    subtype: oneof(=, !=, >, >=, <, <=)
    validations:
      - oneof(=, !=, >, >=, <, <=)
    default: =
  - name: Value
    summary: The value to compare against the field value.
    type: float
    default: 0
  - name: ForceIntegerCompare
    display: Force Integer Comparison
    summary: The field value will be converted to an integer if it isnâ€™t one already.
    type: bool
    default: false
    advanced: true
templates:
  - kind: refinery_rules
    name: CompareIntegerFieldCondition
    format: rules
    meta:
      condition: true
      scope: '{{ if eq .Values.Operator "!=" }}span{{ else }}trace{{ end }}'
    data:
      - key: Fields
        value: "{{ .Values.Fields | encodeAsArray }}"
      - key: Operator
        value: "{{ .Values.Operator }}"
      - key: Value
        value: "{{ if .Values.ForceIntegerCompare }}{{ .Values.Value | encodeAsInt }}{{ else }}{{ .Values.Value | encodeAsFloat }}{{ end }}"
      - key: Datatype
        value: '{{ if .Values.ForceIntegerCompare }}int{{ else }}float{{ end }}'
